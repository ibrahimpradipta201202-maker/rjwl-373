<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Form Absen</title>

<!-- hCaptcha -->
<script src="https://hcaptcha.com/1/api.js" async defer></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
  font-family:'Poppins',sans-serif;
  height:100vh;display:flex;justify-content:center;align-items:center;
  background: linear-gradient(270deg,#6f00ff,#c800ff,#6c63ff,#3498db);
  background-size: 800% 800%;
  animation: gradientBG 25s ease infinite;
  overflow:hidden;
  color:#fff;
}
@keyframes gradientBG{
  0%{background-position:0% 50%;}
  50%{background-position:100% 50%;}
  100%{background-position:0% 50%;}
}
.form-container{
  background: rgba(0,0,0,0.8);
  padding: 40px 30px;
  border-radius: 20px;
  box-shadow: 0 20px 50px rgba(0,0,0,0.7);
  width:98%;max-width:500px;
  text-align:center;
}
h2{
  font-size:28px;
  text-shadow:0 0 15px #6c63ff,0 0 25px #ff00ff;
  margin-bottom:20px;
}
.progress-container{
  width:100%;
  height:8px;
  background: rgba(255,255,255,0.2);
  border-radius:4px;
  overflow:hidden;
  margin-bottom:10px;
}
.progress-bar{
  height:100%;
  width:0%;
  background: linear-gradient(90deg,#6c63ff,#ff00ff,#6c63ff);
  border-radius:4px;
  transition: width 0.5s ease;
  box-shadow:0 0 15px #6c63ff,0 0 25px #ff00ff;
}
.progress-text{margin-bottom:20px;font-size:14px;color:#fff;}
.form-step{display:none;animation: fadeSlide 0.6s forwards;}
.form-step.active{display:block;}
@keyframes fadeSlide{0%{opacity:0;transform:translateY(30px);}100%{opacity:1;transform:translateY(0);}}
input,textarea{
  width:100%;
  padding:14px 18px;
  border-radius:12px;
  border:2px solid #6c63ff;
  outline:none;
  font-size:16px;
  background: rgba(0,0,0,0.3);
  color:#fff;
  box-shadow:0 0 15px #6c63ff inset;
  transition: all 0.3s ease;
  margin-bottom:20px;
}
input:focus,textarea:focus{
  border-color:#ff00ff;
  box-shadow:0 0 30px #ff00ff,0 0 50px #6c63ff inset;
}
button{
  width:100%;
  padding:14px;
  border:none;
  border-radius:15px;
  background: linear-gradient(90deg,#6c63ff,#ff00ff,#6c63ff);
  color:#fff;
  font-size:18px;
  cursor:pointer;
  margin-top:10px;
  text-shadow:0 0 5px #fff;
}
button:hover{box-shadow:0 0 30px #ff00ff,0 0 60px #6c63ff inset;}
button.disabled{
  background: gray !important;
  cursor: not-allowed !important;
  box-shadow: none !important;
}
.success-message{font-size:22px;font-weight:bold;padding:30px;display:none;}
@keyframes confettiFall{0%{transform:translateY(0) rotate(0deg);}100%{transform:translateY(500px) rotate(720deg);}}
.confetti{position:absolute;width:10px;height:10px;opacity:0.8;pointer-events:none;}
</style>
</head>
<body>

<div class="form-container">
  <h2>Absen G-Form</h2>
  <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>
  <div class="progress-text" id="progressText">1 / 5</div>

  <form id="multiStepForm">
    <div class="form-step active">
      <input type="text" name="Nama" placeholder="Nama" required>
      <button type="button" class="next-btn">Next</button>
    </div>

    <div class="form-step">
      <input type="tel" name="Pesan" placeholder="phone number" required>
      <button type="button" class="next-btn">Next</button>
    </div>

    <div class="form-step">
      <input type="number" name="Lokasi" placeholder="number" required>
      <button type="button" class="next-btn">Next</button>
    </div>

    <div class="form-step">
      <input type="file" name="Inti" required>
      <button type="button" class="next-btn">Next</button>
    </div>

    <!-- ðŸ”¥ Step terakhir â†’ Tambah hCaptcha -->
    <div class="form-step">

      <div style="margin-bottom:20px;">
        <div class="h-captcha"
             data-sitekey="a5eee884-12a6-4fac-9480-648ab82c221a"
             data-callback="captchaDone">
        </div>
      </div>

      <button id="submitBtn" type="submit" class="disabled" disabled>Kirim</button>
    </div>
  </form>

  <div class="success-message" id="successMessage">
    Data berhasil dikirim!<br><br>
  </div>
</div>

<script>
const form=document.getElementById('multiStepForm');
const steps=form.querySelectorAll('.form-step');
const progressBar=document.getElementById('progressBar');
const progressText=document.getElementById('progressText');
const successMessage=document.getElementById('successMessage');
let currentStep=0;
const totalSteps=steps.length;

function showStep(index){
  steps.forEach((step,i)=>{
    step.classList.remove('active');
    if(i===index) step.classList.add('active');
  });
  let percent=((index)/totalSteps)*100;
  progressBar.style.width=percent+'%';
  progressText.textContent=`${index+1} / ${totalSteps}`;
}

form.querySelectorAll('.next-btn').forEach(btn=>{
  btn.addEventListener('click',()=>{
    if(currentStep < totalSteps-1){
      currentStep++;
      showStep(currentStep);
    }
  });
});

/* ðŸ”¥ Aktifkan tombol setelah captcha centang */
function captchaDone(){
  const btn=document.getElementById("submitBtn");
  btn.disabled=false;
  btn.classList.remove("disabled");
}

form.addEventListener('submit', async e=>{
  e.preventDefault();

  const formData = {};
  const fileInput = form.querySelector('input[name="Inti"]');
  const file = fileInput.files[0];

  for (let el of form.querySelectorAll("input, textarea")) {
    if (el.name !== "Inti") formData[el.name] = el.value;
  }

  if (file) {
    formData.fileName = file.name;
    const reader = new FileReader();
    formData.Inti = await new Promise(resolve => {
      reader.onload = e => resolve(e.target.result);
      reader.readAsDataURL(file);
    });
  } else formData.Inti = "";

  let submissions = JSON.parse(localStorage.getItem("formSubmissions")) || [];
  submissions.push(formData);
  localStorage.setItem("formSubmissions", JSON.stringify(submissions));

  form.style.display='none';
  successMessage.style.display='block';
  progressBar.style.width='100%';
  progressText.textContent=`${totalSteps} / ${totalSteps}`;

  for(let i=0;i<70;i++){
    const c=document.createElement('div');
    c.classList.add('confetti');
    c.style.left=Math.random()*100+'%';
    c.style.backgroundColor=`hsl(${Math.random()*360},100%,70%)`;
    c.style.animation=`confettiFall ${2+Math.random()*2}s linear forwards`;
    c.style.width=5+Math.random()*10+'px';
    c.style.height=5+Math.random()*10+'px';
    document.body.appendChild(c);
    setTimeout(()=>c.remove(),4000);
  }
});

showStep(currentStep);
</script>
</body>
  </html>
